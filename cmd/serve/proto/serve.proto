syntax = "proto3";

import "google/api/annotations.proto";

package serve;

message GetFileRequest {
  string path = 1;
}

message GetFileResponse {
  string path = 1;
  string contents = 2;
}

message GetAnnotationsRequest {
  string path = 1;
}

message GetAnnotationsResponse {
  string path = 1;
  repeated Annotation annotation = 2;
}

message Annotation {
  Location from = 1;
  Location to = 2;
  Type type = 3;
}

message Location {
  string package = 1;
  string filename = 2;
  int64 start_line = 3;
  int64 start_column = 4;
  int64 end_line = 5;
  int64 end_column = 6;
}

enum Type {
  Instantiation = 0;
  Call = 1;
  Implementation = 2;
  Extension = 3;
  Import = 4;
  Reference = 5;
}

service Goref {
  rpc GetFile(GetFileRequest) returns (GetFileResponse) {
    option (google.api.http) = {
      get: "/v1/goref/file/{path=**}"
    };
  }

  rpc GetAnnotations(GetAnnotationsRequest) returns (GetAnnotationsResponse) {
    option (google.api.http) = {
      get: "/v1/goref/annotations/{path=**}"
    };
  }
}
